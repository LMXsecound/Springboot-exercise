<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.example.mapper.StudentMapper">
    <select id="list" resultType="org.example.pojo.Student">
        select
        id,
        name,
        no,
        gender,
        phone,
        id_card,
        is_college,
        address,
        degree,
        graduation_date,
        clazz_id,
        violation_count,
        violation_score,
        create_time,
        update_time,
        clazz_name
        from student
        where 1=1
        <if test="name != null and name != ''">
            and name like concat('%',#{name},'%')
        </if>
    </select>
    <delete id="deleteByIds">
        delete from student where id in
        <foreach item="id" collection="list" separator="," open="(" close=")">
            #{id}
        </foreach>
    </delete>

    <select id="getById" resultType="org.example.pojo.Student">
        select
        id,
        name,
        no,
        gender,
        phone,
        id_card,
        is_college,
        address,
        degree,
        graduation_date,
        clazz_id,
        violation_count,
        violation_score,
        create_time,
        update_time
        from student
        where id = #{id}
    </select>

    <insert id="insert">
        insert into student(name,no,gender,phone,id_card,is_college,address,degree,graduation_date,clazz_id,violation_count,violation_score,create_time,update_time) values(#{name},#{no},#{gender},#{phone},#{idCard},#{isCollege},#{address},#{degree},#{graduationDate},#{clazzId},#{violationCount},#{violationScore},#{createTime},#{updateTime})
    </insert>
    
    <update id="update">
        update student
        set name = #{name},
            no = #{no},
            gender = #{gender},
            phone = #{phone},
            id_card = #{idCard},
            is_college = #{isCollege},
            address = #{address},
            degree = #{degree},
            graduation_date = #{graduationDate},
            clazz_id = #{clazzId},
            violation_count = #{violationCount},
            violation_score = #{violationScore},
            update_time = #{updateTime}
        where id = #{id}
    </update>

    <update id="updateViolation">
        update student
            set violation_count = violation_count + 1,
                violation_score = violation_score + #{score},
                update_time = #{updateTime}
        where id = #{id}
    </update>
</mapper>